<!DOCTYPE html>
<html lang="ko">
<head>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2900491622305328"
     crossorigin="anonymous"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ÏõêÏÑùTÏùò Îß§Ïì∞ Î∞îÏù¥Î∏å (MATH VIBE)</title>
    <meta name="description" content="ÏàòÌïôÏùÄ Î≠êÎã§? EASY! ÏõêÏÑùTÏôÄ Ìï®ÍªòÌïòÎäî Ï¶êÍ±∞Ïö¥ ÏàòÌïô Í≤åÏûÑ">
    
    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- MathJax -->
    <script>
        window.MathJax = {
            tex: { inlineMath: [['$', '$'], ['\\(', '\\)']] },
            svg: { fontCache: 'global' },
            startup: { typeset: false }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Black+Han+Sans&family=Do+Hyeon&family=Noto+Sans+KR:wght@300;400;700;900&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Permanent+Marker&display=swap');
        
        /* Í∏∞Î≥∏ ÏÑ§Ï†ï Î∞è Ïä§ÌÅ¨Î°§ ÌôúÏÑ±Ìôî */
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #0f172a;
            color: white;
            overflow-x: hidden; /* Í∞ÄÎ°ú Ïä§ÌÅ¨Î°§Îßå Î∞©ÏßÄ */
            overflow-y: auto;   /* ÏÑ∏Î°ú Ïä§ÌÅ¨Î°§ ÌóàÏö© (Î™®Î∞îÏùº ÎåÄÏùë) */
            -webkit-overflow-scrolling: touch; /* Î∂ÄÎìúÎü¨Ïö¥ Ïä§ÌÅ¨Î°§ */
            touch-action: pan-y;
        }

        .font-logo { font-family: 'Black Han Sans', sans-serif; }
        .font-game { font-family: 'Do Hyeon', sans-serif; }
        .font-marker { font-family: 'Permanent Marker', cursive; }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1e293b; }
        ::-webkit-scrollbar-thumb { background: #475569; border-radius: 4px; }
        
        /* Glassmorphism */
        .glass {
            background: rgba(15, 23, 42, 0.85); /* Î™®Î∞îÏùº Í∞ÄÎèÖÏÑ±ÏùÑ ÏúÑÌï¥ Î∂àÌà¨Î™ÖÎèÑ ÏïΩÍ∞Ñ ÏÉÅÌñ• */
            backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        }

        .glass-red {
            background: rgba(69, 10, 10, 0.8);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(239, 68, 68, 0.3);
        }
        
        /* Neon Effects */
        .neon-blue { text-shadow: 0 0 10px #3b82f6, 0 0 20px #2563eb; }
        .neon-purple { text-shadow: 0 0 10px #a855f7, 0 0 20px #9333ea; }
        .neon-red { text-shadow: 0 0 10px #ef4444, 0 0 20px #dc2626; }
        
        /* Animations */
        @keyframes float { 0% { transform: translateY(0px); } 50% { transform: translateY(-15px); } 100% { transform: translateY(0px); } }
        .animate-float { animation: float 4s ease-in-out infinite; }
        
        @keyframes slideUp { from { transform: translateY(50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .animate-slide-up { animation: slideUp 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards; }

        .shake { animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes shake { 10%, 90% { transform: translateX(-1px); } 20%, 80% { transform: translateX(2px); } 30%, 50%, 70% { transform: translateX(-4px); } 40%, 60% { transform: translateX(4px); } }

        .intro-text-easy {
            background: linear-gradient(120deg, #84fab0 0%, #8fd3f4 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            transform: rotate(-5deg);
        }
        
        .locked-overlay {
            background: repeating-linear-gradient(
                45deg,
                rgba(0, 0, 0, 0.7),
                rgba(0, 0, 0, 0.7) 10px,
                rgba(220, 38, 38, 0.2) 10px,
                rgba(220, 38, 38, 0.2) 20px
            );
            pointer-events: none;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // ----------------------------------------------------------------------------
        // 1. DATA & GENERATOR
        // ----------------------------------------------------------------------------
        const getRandomInt = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;
        const getRandomItem = (arr) => arr[Math.floor(Math.random() * arr.length)];

        // (A) Infinite Generator
        const Generator = {
            algebra: (diff) => {
                if(diff <= 3) {
                    const type = getRandomInt(1, 5);
                    if(type === 1) { 
                        const p1=getRandomInt(2,5), p2=getRandomInt(1,3);
                        return { q: `$\\log_2 ${Math.pow(2,p1)} + \\log_2 ${Math.pow(2,p2)}$`, a: String(p1+p2), time:20, type:'short' };
                    } else if(type === 2) { 
                        const a = getRandomInt(2,9), d=getRandomInt(2,6);
                        const n = getRandomInt(5,10);
                        return { q: `Ï≤´Ïß∏Ìï≠ ${a}, Í≥µÏ∞® ${d}Ïù∏ Îì±Ï∞®ÏàòÏó¥Ïùò Ï†ú${n}Ìï≠ÏùÄ?`, a: String(a+(n-1)*d), time:25, type:'short' };
                    } else if(type === 3) { 
                        const base = getRandomInt(2,3);
                        const exp1 = getRandomInt(2,3);
                        const exp2 = getRandomInt(1,2);
                        return { q: `$${base}^${exp1} \\times ${base}^${exp2}$ Ïùò Í∞íÏùÄ?`, a: String(Math.pow(base, exp1+exp2)), time:15, type:'short' };
                    } else if(type === 4) { 
                        const n = getRandomInt(5, 20);
                        const c = getRandomInt(2, 9);
                        return { q: `$\\sum_{k=1}^{${n}} ${c}$ Ïùò Í∞íÏùÄ?`, a: String(n*c), time:15, type:'short' };
                    } else { 
                        const sum = getRandomInt(3, 9);
                        const prod = getRandomInt(2, 10);
                        return { q: `Ïù¥Ï∞®Î∞©Ï†ïÏãù $x^2 - ${sum}x + ${prod} = 0$ Ïùò Îëê Í∑ºÏùò Ìï©ÏùÄ?`, a: String(sum), time:20, type:'short' };
                    }
                }
                return null;
            },
            calculus: (diff) => {
                if(diff <= 3) {
                    const type = getRandomInt(1, 4);
                    if(type === 1) { 
                        const a = getRandomInt(1,3);
                        return { q: `$\\lim_{x \\to ${a}} (x^2 + ${getRandomInt(1,5)}x)$`, a: String(a*a + a*getRandomInt(1,5) || a*a+a), time:20, type:'short' };
                    } else if(type === 2) { 
                        const a = getRandomInt(2,9);
                        const b = getRandomInt(1,9);
                        return { q: `Ìï®Ïàò $f(x)=x^3 + ${a}x + ${b}$ Ïóê ÎåÄÌïòÏó¨ $f'(0)$ÏùÄ?`, a: String(a), time:20, type:'short' };
                    } else if(type === 3) { 
                        const n = getRandomInt(1,2);
                        return { q: `$\\int_0^{${n+1}} ${n+1}x^${n} dx$`, a: String(Math.pow(n+1, n+1)), time:25, type:'short' };
                    } else { 
                        return { q: `Ìï®Ïàò $f(x)=x^2$ÏóêÏÑú $x$Í∞Ä 0ÏóêÏÑú 2ÍπåÏßÄ Î≥ÄÌï† Îïå ÌèâÍ∑†Î≥ÄÌôîÏú®ÏùÄ?`, a: "2", time:20, type:'short'};
                    }
                }
                return null;
            },
            geometry: (diff) => {
                if(diff <= 3) {
                    const type = getRandomInt(1, 3);
                    if(type === 1) { 
                        const x1=getRandomInt(1,4), y1=getRandomInt(1,3);
                        if(x1==3 && y1==4) return { q: `$\\vec{a}=(3, 4)$ Ïùò ÌÅ¨Í∏∞Îäî?`, a: "5", time:15, type:'short' };
                        return { q: `Î≤°ÌÑ∞ $\\vec{a}=(${x1}, ${y1})$ Ïùò ÌÅ¨Í∏∞Ïùò Ï†úÍ≥±ÏùÄ?`, a: String(x1*x1 + y1*y1), time:20, type:'short' };
                    } else if(type===2) { 
                        const p = getRandomInt(1,5);
                        return { q: `Ìè¨Î¨ºÏÑ† $y^2=${4*p}x$Ïùò Ï¥àÏ†êÏùò $x$Ï¢åÌëúÎäî?`, a: String(p), time:15, type:'short'};
                    } else { 
                        const a = getRandomInt(3,6);
                        const b = getRandomInt(1,2);
                        return { q: `ÌÉÄÏõê $\\frac{x^2}{${a*a}} + \\frac{y^2}{${b*b}} = 1$ Ïùò Ïû•Ï∂ïÏùò Í∏∏Ïù¥Îäî?`, a: String(2*a), time:20, type:'short'};
                    }
                }
                return null;
            },
            prob_stat: (diff) => {
                if(diff <= 3) {
                    const type = getRandomInt(1, 3);
                    if(type===1) { 
                        const n=getRandomInt(4,9);
                        return { q: `$_${n}\\mathrm{P}_2$ Ïùò Í∞íÏùÄ?`, a: String(n*(n-1)), time:15, type:'short'};
                    } else if(type===2) { 
                        const n=getRandomInt(4,9);
                        return { q: `$_${n}\\mathrm{C}_2$ Ïùò Í∞íÏùÄ?`, a: String((n*(n-1))/2), time:20, type:'short'};
                    } else { 
                        const n=getRandomInt(10,50)*2;
                        return { q: `Ïù¥Ìï≠Î∂ÑÌè¨ $B(${n}, \\frac{1}{2})$ Ïùò ÌèâÍ∑†ÏùÄ?`, a: String(n/2), time:20, type:'short'};
                    }
                }
                return null;
            }
        };

        // (B) Expanded Static DB (Diff 3-6)
        const STATIC_DB = [
            // Algebra
            { subject: 'algebra', diff: 3, q: '$\\sum_{k=1}^{10} (2k - 1)$ Ïùò Í∞íÏùÑ Íµ¨ÌïòÏãúÏò§.', a: '100' },
            { subject: 'algebra', diff: 3, q: 'Îì±ÎπÑÏàòÏó¥ $2, 4, 8, \\dots$ Ïùò Ï†ú 7Ìï≠ÏùÄ?', a: '128' },
            { subject: 'algebra', diff: 3, q: '$4^{\\frac{3}{2}}$ Ïùò Í∞íÏùÄ?', a: '8' },
            { subject: 'algebra', diff: 3, q: 'Î∂ÄÎì±Ïãù $3^{x-1} < 27$ ÏùÑ ÎßåÏ°±ÌïòÎäî ÏûêÏó∞Ïàò $x$Ïùò Í∞úÏàòÎäî?', a: '3' },
            { subject: 'algebra', diff: 3, q: '$\\log_3 9 + \\log_2 16$ Ïùò Í∞íÏùÄ?', a: '6' },
            { subject: 'algebra', diff: 4, q: 'Ïù¥Ï∞®Î∞©Ï†ïÏãù $x^2 - 4x - 12 = 0$ Ïùò Îëê Í∑ºÏùò Ï∞®Îäî?', a: '8' },
            { subject: 'algebra', diff: 4, q: 'ÏàòÏó¥ $\\{a_n\\}$Ïù¥ $a_1=1, a_{n+1}=a_n+3$Ïùº Îïå, $a_{10}$ÏùÄ?', a: '28' },
            { subject: 'algebra', diff: 4, q: 'ÏÇºÍ∞ÅÌï®Ïàò $y=2\\sin(3x) + 1$ Ïùò ÏµúÎåìÍ∞íÏùÄ?', a: '3' },
            { subject: 'algebra', diff: 4, q: '$\\log_3 2 \\times \\log_2 27$ Ïùò Í∞íÏùÄ?', a: '3' },
            { subject: 'algebra', diff: 4, q: '$\\sum_{k=1}^5 k^2$ Ïùò Í∞íÏùÄ?', a: '55' },
            { subject: 'algebra', diff: 5, q: '$\\log_2 (x-1) + \\log_2 (x+2) = 2$ Î•º ÎßåÏ°±ÌïòÎäî ÏñëÏàò $x$?', a: '2' },
            { subject: 'algebra', diff: 5, q: 'Î™®Îì† Ïã§Ïàò $x$Ïóê ÎåÄÌïòÏó¨ $x^2 + 2ax + 9 \\ge 0$ Ïù¥ ÏÑ±Î¶ΩÌï† Îïå ÏñëÏàò $a$Ïùò ÏµúÎåìÍ∞í?', a: '3' },
            { subject: 'algebra', diff: 5, q: 'ÏàòÏó¥ $\\{a_n\\}$Ïùò Ìï© $S_n = n^2 + n$ Ïùº Îïå, $a_5$Ïùò Í∞íÏùÄ?', a: '10' },
            { subject: 'algebra', diff: 5, q: 'ÏÇºÍ∞ÅÎ∞©Ï†ïÏãù $2\\sin^2 x - \\cos x - 1 = 0$ ($0 \\le x < 2\\pi$)Ïùò Ïã§Í∑ºÏùò Í∞úÏàòÎäî?', a: '3' },
            { subject: 'algebra', diff: 5, q: 'Îì±Ï∞®ÏàòÏó¥ $\\{a_n\\}$Ïóê ÎåÄÌïòÏó¨ $a_3=7, a_7=15$Ïùº Îïå $a_{10}$ÏùÄ?', a: '21' },
            { subject: 'algebra', diff: 6, q: 'ÏàòÏó¥ $\\{a_n\\}$Ïóê ÎåÄÌïòÏó¨ $\\sum a_k = n^2+2n$ Ïùº Îïå, $a_1+a_{10}$?', a: '24' },
            { subject: 'algebra', diff: 6, q: 'Î∞©Ï†ïÏãù $4^x - 3 \\cdot 2^{x+1} + 8 = 0$ Ïùò Îëê Ïã§Í∑ºÏùò Ìï©ÏùÄ?', a: '3' },
            { subject: 'algebra', diff: 6, q: 'ÏàòÏó¥ $\\{a_n\\}$Ïù¥ $a_1=2, a_{n+1} = 2a_n$Ïùº Îïå $\\log_2 a_{10}$Ïùò Í∞íÏùÄ?', a: '10' },
            { subject: 'algebra', diff: 6, q: '$f(x)=2^x + 2^{-x}$ Ïùò ÏµúÏÜüÍ∞íÏùÄ?', a: '2' },

            // Calculus
            { subject: 'calculus', diff: 3, q: 'Í≥°ÏÑ† $y=x^2-4x$ ÏúÑÏùò Ï†ê $(1,-3)$ÏóêÏÑúÏùò Ï†ëÏÑ†Ïùò Í∏∞Ïö∏Í∏∞Îäî?', a: '-2' },
            { subject: 'calculus', diff: 3, q: '$\\int_1^3 2x dx$ Ïùò Í∞íÏùÄ?', a: '8' },
            { subject: 'calculus', diff: 3, q: '$\\lim_{x \\to \\infty} \\frac{2x^2+1}{x^2-3}$ Ïùò Í∞íÏùÄ?', a: '2' },
            { subject: 'calculus', diff: 3, q: 'Ìï®Ïàò $f(x)=x^3$Ïóê ÎåÄÌïòÏó¨ $f\'(2)$Ïùò Í∞íÏùÄ?', a: '12' },
            { subject: 'calculus', diff: 4, q: 'Ìï®Ïàò $f(x)=x^3-3x^2+k$Ïùò Í∑πÏÜüÍ∞íÏù¥ 2Ïùº Îïå $k$Îäî?', a: '6' },
            { subject: 'calculus', diff: 4, q: 'Í≥°ÏÑ† $y=x^3$Í≥º $x$Ï∂ï Î∞è $x=2$Î°ú ÎëòÎü¨Ïã∏Ïù∏ ÎÑìÏù¥Îäî?', a: '4' },
            { subject: 'calculus', diff: 4, q: 'Ìï®Ïàò $f(x)=\\ln x$Ïóê ÎåÄÌïòÏó¨ $f\'(e)$Ïùò Í∞íÏùÄ?', a: '1/e', subA: ['1/e', 'e^-1'] },
            { subject: 'calculus', diff: 4, q: '$\\lim_{x \\to 0} \\frac{\\sin 3x}{x}$ Ïùò Í∞íÏùÄ?', a: '3' },
            { subject: 'calculus', diff: 5, q: '$\\int_0^{\\pi} x \\sin x dx$ Ïùò Í∞íÏùÄ?', a: 'pi', subA:['pi','3.14','ÌååÏù¥'] },
            { subject: 'calculus', diff: 5, q: 'Í≥°ÏÑ† $y=x^2$Í≥º ÏßÅÏÑ† $y=x$Î°ú ÎëòÎü¨Ïã∏Ïù∏ ÎÑìÏù¥Ïóê 6ÏùÑ Í≥±ÌïòÎ©¥?', a: '1' },
            { subject: 'calculus', diff: 5, q: '$\\lim_{x \\to 0} \\frac{\\ln(1+3x)}{x}$ Ïùò Í∞íÏùÄ?', a: '3' },
            { subject: 'calculus', diff: 5, q: 'Ìï®Ïàò $f(x)=x e^{-x}$ Ïùò ÏµúÎåìÍ∞íÏùÄ $1/e$Ïù¥Îã§. Í∑πÎåìÍ∞íÏùÑ Í∞ñÎäî $x$Ï¢åÌëúÎäî?', a: '1' },
            { subject: 'calculus', diff: 5, q: '$\\int_0^1 e^{2x} dx$ Ïùò Í∞íÏùÄ? (Îã®, ÎãµÏùÄ (e^2-1)/2)', a: '(e^2-1)/2', subA:['(e^2-1)/2', '0.5(e^2-1)'] },
            { subject: 'calculus', diff: 6, q: 'Ìï®Ïàò $f(x)=\\ln x$ ÏúÑÏùò Ï†ê $(e,1)$ÏóêÏÑúÏùò Ï†ëÏÑ†Ïùò $y$Ï†àÌé∏?', a: '0' },
            { subject: 'calculus', diff: 6, q: '$\\int_1^e x \\ln x dx$Ïùò Í∞íÏùÄ $\\frac{e^2+a}{4}$Ïù¥Îã§. $a$Ïùò Í∞íÏùÄ?', a: '1' },
            { subject: 'calculus', diff: 6, q: 'ÏàòÏßÅÏÑ† ÏúÑÎ•º ÏõÄÏßÅÏù¥Îäî Ï†ê PÏùò ÏÜçÎèÑ $v(t)=3t^2-6t$Ïùº Îïå, $t=0$ÏóêÏÑú $t=3$ÍπåÏßÄ ÏõÄÏßÅÏù∏ Í±∞Î¶¨Îäî?', a: '8' },
            { subject: 'calculus', diff: 6, q: 'Í≥°ÏÑ† $y=\\frac{1}{x}$ ÏúÑÏùò Ï†ê $(1,1)$ÏóêÏÑúÏùò Ï†ëÏÑ†Ïù¥ $x$Ï∂ïÍ≥º ÎßåÎÇòÎäî Ï†êÏùò $x$Ï¢åÌëúÎäî?', a: '2' },

            // Geometry
            { subject: 'geometry', diff: 3, q: 'ÌÉÄÏõê $\\frac{x^2}{16}+\\frac{y^2}{7}=1$Ïùò Îëê Ï¥àÏ†ê ÏÇ¨Ïù¥ Í±∞Î¶¨Îäî?', a: '6' },
            { subject: 'geometry', diff: 3, q: 'Ìè¨Î¨ºÏÑ† $y^2=12x$Ïùò Ï§ÄÏÑ†Ïùò Î∞©Ï†ïÏãùÏùÄ $x=k$Ïù¥Îã§. $k$Îäî?', a: '-3' },
            { subject: 'geometry', diff: 3, q: 'Î≤°ÌÑ∞ $\\vec{a}=(1,2)$ÏôÄ $\\vec{b}=(3,1)$Ïùò ÎÇ¥Ï†ÅÍ∞íÏùÄ?', a: '5' },
            { subject: 'geometry', diff: 4, q: 'ÏåçÍ≥°ÏÑ† $x^2-y^2=2$ ÏúÑÏùò Ï†ê $(2,\\sqrt{2})$ÏóêÏÑú Ï†ëÏÑ†Ïùò Í∏∞Ïö∏Í∏∞ Ï†úÍ≥±ÏùÄ?', a: '2' },
            { subject: 'geometry', diff: 4, q: 'Î≤°ÌÑ∞ $\\vec{a}=(1,2), \\vec{b}=(3, k)$Í∞Ä ÏàòÏßÅÏùº Îïå $k$?', a: '-1.5', subA:['-1.5','-3/2'] },
            { subject: 'geometry', diff: 4, q: 'Ï¢åÌëúÍ≥µÍ∞ÑÏùò Ï†ê $(1,2,3)$ÏóêÏÑú $xy$ÌèâÎ©¥ÍπåÏßÄÏùò Í±∞Î¶¨Îäî?', a: '3' },
            { subject: 'geometry', diff: 4, q: 'Îëê Î≤°ÌÑ∞ $\\vec{a}, \\vec{b}$Í∞Ä Ïù¥Î£®Îäî Í∞ÅÏù¥ $60^\\circ$Ïù¥Í≥† ÌÅ¨Í∏∞Í∞Ä Í∞ÅÍ∞Å 2, 3Ïùº Îïå ÎÇ¥Ï†Å?', a: '3' },
            { subject: 'geometry', diff: 5, q: '$\\mid\\vec{a}\\mid=2, \\mid\\vec{b}\\mid=3$Ïù¥Í≥† Í∞ÅÏù¥ $60^\\circ$Ïùº Îïå $\\mid\\vec{a}-\\vec{b}\\mid^2$Ïùò Í∞íÏùÄ?', a: '7' },
            { subject: 'geometry', diff: 5, q: 'Íµ¨ $x^2+y^2+z^2-2x-4y=0$Ïùò Î∞òÏßÄÎ¶Ñ Ï†úÍ≥±ÏùÄ?', a: '5' },
            { subject: 'geometry', diff: 5, q: 'Ìè¨Î¨ºÏÑ† $y^2=8x$ ÏúÑÏùò Ï†ê $(2,4)$ÏóêÏÑúÏùò Ï†ëÏÑ†Ïùò $x$Ï†àÌé∏ÏùÄ?', a: '-2' },
            { subject: 'geometry', diff: 6, q: 'Î≤°ÌÑ∞ $\\vec{a}+\\vec{b}$ÏôÄ $\\vec{a}-\\vec{b}$Í∞Ä ÏàòÏßÅÏù¥Í≥† $\\mid\\vec{a}\\mid=2$Ïùº Îïå $\\mid\\vec{b}\\mid$?', a: '2' },
            { subject: 'geometry', diff: 6, q: 'ÌèâÎ©¥ $\\alpha$ÏôÄ $\\beta$Í∞Ä Ïù¥Î£®Îäî Í∞ÅÏù¥ $60^\\circ$Ïù¥Í≥†, $\\alpha$ ÏúÑÏùò ÎÑìÏù¥ 10Ïù∏ ÎèÑÌòïÏùò $\\beta$ ÏúÑÎ°úÏùò Ï†ïÏÇ¨ÏòÅ ÎÑìÏù¥Îäî?', a: '5' },
            { subject: 'geometry', diff: 6, q: 'ÌÉÄÏõê $\\frac{x^2}{25} + \\frac{y^2}{9} = 1$ Ïùò Îã®Ï∂ïÏùò Í∏∏Ïù¥Îäî?', a: '6' },

            // Prob/Stat
            { subject: 'prob_stat', diff: 3, q: '$_6\\mathrm{C}_2$ Ïùò Í∞íÏùÄ?', a: '15' },
            { subject: 'prob_stat', diff: 3, q: 'Ïù¥Ìï≠Î∂ÑÌè¨ $B(10, 0.5)$Ïùò Î∂ÑÏÇ∞ÏùÄ?', a: '2.5', subA:['2.5','5/2'] },
            { subject: 'prob_stat', diff: 3, q: '$_5\\mathrm{P}_3$ Ïùò Í∞íÏùÄ?', a: '60' },
            { subject: 'prob_stat', diff: 4, q: '5Í∞ú Î¨∏Ïûê A,A,A,B,B ÏùºÎ†¨ ÎÇòÏó¥ Í≤ΩÏö∞Ïùò Ïàò?', a: '10' },
            { subject: 'prob_stat', diff: 4, q: 'Ï£ºÏÇ¨ÏúÑ 2Í∞ú Ìï©Ïù¥ 10 Ïù¥ÏÉÅÏùº ÌôïÎ•†ÏùÄ $1/k$Ïù¥Îã§. $k$Îäî?', a: '6' },
            { subject: 'prob_stat', diff: 4, q: 'Îëê ÏÇ¨Í±¥ A,B ÎèÖÎ¶Ω, $P(A)=0.5, P(B)=0.4$Ïùº Îïå ÍµêÏßëÌï© ÌôïÎ•†?', a: '0.2' },
            { subject: 'prob_stat', diff: 4, q: 'ÏÑúÎ°ú Îã§Î•∏ Ï£ºÏÇ¨ÏúÑ 2Í∞úÎ•º ÎèôÏãúÏóê ÎçòÏßà Îïå ÎààÏùò ÏàòÏùò Ï∞®Í∞Ä 0Ïùº ÌôïÎ•†ÏùÄ $1/k$. $k$Îäî?', a: '6' },
            { subject: 'prob_stat', diff: 5, q: 'Î∞©Ï†ïÏãù $x+y+z=9$ (ÏùåÏù¥ ÏïÑÎãå Ï†ïÏàòÌï¥) Í∞úÏàò?', a: '55' },
            { subject: 'prob_stat', diff: 5, q: 'ÎÇ®ÌïôÏÉù 3Î™Ö, Ïó¨ÌïôÏÉù 2Î™Ö ÏõêÌÉÅÏóê ÏïâÏùÑ Îïå Ïó¨ÌïôÏÉùÎÅºÎ¶¨ Ïù¥ÏõÉÌï† ÌôïÎ•† Î∂ÑÎ™®(Í∏∞ÏïΩÎ∂ÑÏàò)?', a: '5' }, 
            { subject: 'prob_stat', diff: 5, q: '1~10 Ï§ë 3Í∞ú ÎΩëÏùÑ Îïå ÏµúÎåÄÍ∞íÏù¥ 8Ïùº ÌôïÎ•† Î∂ÑÎ™®(Í∏∞ÏïΩÎ∂ÑÏàò)?', a: '40', subA: ['40'] }, 
            { subject: 'prob_stat', diff: 5, q: 'Ïù¥Ìï≠Î∂ÑÌè¨ $B(n, 1/2)$Ïùò Î∂ÑÏÇ∞Ïù¥ 25Ïùº Îïå $n$Ïùò Í∞íÏùÄ?', a: '100' },
            { subject: 'prob_stat', diff: 6, q: 'ÌôïÎ•†Î≥ÄÏàò $X$Í∞Ä $N(10, 2^2)$ÏùÑ Îî∞Î•º Îïå $P(X \\le 10)$?', a: '0.5' },
            { subject: 'prob_stat', diff: 6, q: 'Í∞ôÏùÄ Ï¢ÖÎ•ò ÏÇ¨ÌÉï 10Í∞úÎ•º 3Î™ÖÏóêÍ≤å Ï†ÅÏñ¥ÎèÑ 1Í∞úÏî© Ï£ºÎäî Í≤ΩÏö∞Ïùò Ïàò?', a: '36' },
            { subject: 'prob_stat', diff: 6, q: 'Ï£ºÏÇ¨ÏúÑ 1Í∞úÎ•º 3Î≤à ÎçòÏßà Îïå, ÎÇòÏò§Îäî ÎààÏùò ÏàòÍ∞Ä Î™®Îëê Îã§Î•º ÌôïÎ•†ÏùÄ $5/k$Ïù¥Îã§. $k$Îäî?', a: '9' }
        ];

        const TIERS = [
            { name: "BRONZE", color: "text-orange-400", bg: "bg-orange-600" },
            { name: "SILVER", color: "text-slate-300", bg: "bg-slate-500" },
            { name: "GOLD", color: "text-yellow-400", bg: "bg-yellow-600" },
            { name: "PLATINUM", color: "text-cyan-400", bg: "bg-cyan-600" },
            { name: "DIAMOND", color: "text-purple-400", bg: "bg-purple-600" },
            { name: "CHALLENGER", color: "text-red-500", bg: "bg-red-600" }
        ];

        const SUBJ_MAP = {
            'algebra': 'ÎåÄÏàò', 'calculus': 'ÎØ∏Ï†ÅÎ∂Ñ', 'geometry': 'Í∏∞Ìïò', 'prob_stat': 'ÌôïÎ•†Í≥º ÌÜµÍ≥Ñ'
        };

        // ----------------------------------------------------------------------------
        // 2. MAIN APP COMPONENT
        // ----------------------------------------------------------------------------

        const App = () => {
            const [scene, setScene] = useState('menu'); 
            
            // Shared Game State
            const [soloMode, setSoloMode] = useState(''); 
            const [soloQs, setSoloQs] = useState([]);
            const [qIndex, setQIndex] = useState(0);
            const [score, setScore] = useState(0);
            const [timeLeft, setTimeLeft] = useState(0);
            const [input, setInput] = useState('');
            const [feedback, setFeedback] = useState(null);
            const [combo, setCombo] = useState(0);
            const [history, setHistory] = useState([]);

            // Practice Setup
            const [pSubj, setPSubj] = useState(null);
            const [pDiff, setPDiff] = useState(null); 

            // Battle State
            const [battleRound, setBattleRound] = useState(1);
            const [battleQs, setBattleQs] = useState([]);
            const [p1Score, setP1Score] = useState(0);
            const [p2Score, setP2Score] = useState(0);
            const [p1In, setP1In] = useState('');
            const [p2In, setP2In] = useState('');
            const [roundWinner, setRoundWinner] = useState(null);
            const [p1Locked, setP1Locked] = useState(false);
            const [p2Locked, setP2Locked] = useState(false);

            const timerRef = useRef(null);

            // MathJax Trigger
            useEffect(() => {
                if (window.MathJax) {
                    setTimeout(() => window.MathJax.typesetPromise(), 50);
                }
            }, [scene, qIndex, feedback, battleRound, roundWinner]);

            // Timer Logic
            useEffect(() => {
                if ((scene === 'game_solo' || scene === 'game_battle') && !feedback && !roundWinner) {
                    if (timeLeft > 0) {
                        timerRef.current = setTimeout(() => setTimeLeft(prev => prev - 1), 1000);
                    } else {
                        if (scene === 'game_solo') handleSoloSubmit(null, true);
                        if (scene === 'game_battle') handleBattleEnd('timeout');
                    }
                }
                return () => clearTimeout(timerRef.current);
            }, [timeLeft, scene, feedback, roundWinner]);

            // ------------------------------------------------------------------------
            // LOGIC
            // ------------------------------------------------------------------------
            
            const createSoloPool = (mode, subj, diff) => {
                let pool = [];
                const count = mode === 'challenge' ? 20 : 10;
                
                for(let i=0; i<count; i++) {
                    let tDiff = diff === 'ALL' ? getRandomInt(1, 6) : diff;
                    let tSubj = (subj === 'RANDOM' || !subj) ? getRandomItem(Object.keys(SUBJ_MAP)) : subj;

                    if (mode === 'challenge') {
                        if (i < 5) tDiff = getRandomInt(1,2);
                        else if (i < 12) tDiff = getRandomInt(3,4);
                        else tDiff = getRandomInt(5,6);
                        tSubj = getRandomItem(Object.keys(SUBJ_MAP));
                    }

                    // 1. Try Generator
                    let q = null;
                    if (tDiff <= 3 && Generator[tSubj]) q = Generator[tSubj](tDiff);
                    
                    // 2. Try Static DB
                    if (!q) {
                        const cands = STATIC_DB.filter(x => x.subject === tSubj && Math.abs(x.diff - tDiff) <= 1);
                        if(cands.length > 0) q = getRandomItem(cands);
                    }
                    
                    // 3. Fallback
                    if (!q && Generator[tSubj]) q = Generator[tSubj](1);
                    if (!q) q = STATIC_DB[0];

                    if(q) {
                        const qTime = q.time || (tDiff <= 2 ? 20 : tDiff <= 4 ? 30 : 60);
                        pool.push({ ...q, id: `q_${i}_${Date.now()}_${Math.random()}`, diff: tDiff, subject: tSubj, time: qTime });
                    }
                }
                return pool;
            };

            const startSolo = (mode, s, d) => {
                const qs = createSoloPool(mode, s, d);
                setSoloMode(mode);
                setSoloQs(qs);
                setQIndex(0);
                setScore(0);
                setCombo(0);
                setHistory([]);
                setInput('');
                setFeedback(null);
                setTimeLeft(qs[0].time);
                setScene('game_solo');
            };

            const handleSoloSubmit = (val, isTimeout=false) => {
                const cur = soloQs[qIndex];
                const userAns = val !== null ? val : input;
                const normUser = String(userAns).trim().replace(/\s+/g, '');
                const normCorr = String(cur.a).trim().replace(/\s+/g, '');
                
                let isCorrect = !isTimeout && (normUser === normCorr);
                if(!isCorrect && !isTimeout && cur.subA && cur.subA.includes(normUser)) isCorrect = true;

                setHistory(prev => [...prev, { ...cur, userAns: isTimeout?'TIME':userAns, isCorrect }]);

                if(isCorrect) {
                    const bonus = cur.diff*100 + timeLeft*10 + combo*50;
                    setScore(prev => prev + 100 + bonus);
                    setCombo(prev => prev + 1);
                    setFeedback('correct');
                } else {
                    setCombo(0);
                    setFeedback(isTimeout ? 'timeout' : 'wrong');
                }

                setTimeout(() => {
                    if(qIndex < soloQs.length - 1) {
                        setQIndex(prev => prev + 1);
                        setTimeLeft(soloQs[qIndex+1].time);
                        setInput('');
                        setFeedback(null);
                    } else {
                        setScene('result_solo');
                    }
                }, 1500);
            };

            const startBattle = () => {
                const hardPool = STATIC_DB.filter(q => q.diff >= 4);
                const qs = hardPool.sort(() => 0.5 - Math.random()).slice(0, 3);
                
                setBattleQs(qs.length < 3 ? STATIC_DB.slice(0,3) : qs);
                setBattleRound(1);
                setP1Score(0);
                setP2Score(0);
                setP1In('');
                setP2In('');
                setP1Locked(false);
                setP2Locked(false);
                setRoundWinner(null);
                setTimeLeft(180); // 3 minutes
                setScene('game_battle');
            };

            const checkBattle = (player, val) => {
                const cur = battleQs[battleRound - 1];
                const cleanVal = String(val).trim().replace(/\s+/g, '');
                let isCorrect = (cleanVal === String(cur.a));
                if(!isCorrect && cur.subA && cur.subA.includes(cleanVal)) isCorrect = true;
                
                if(isCorrect) {
                    handleBattleEnd(player);
                } else {
                    // Penalty and Lock
                    if (player === 'p1') {
                        setP1Score(prev => prev - 50);
                        setP1Locked(true);
                        setP1In('WRONG');
                    } else {
                        setP2Score(prev => prev - 50);
                        setP2Locked(true);
                        setP2In('WRONG');
                    }
                    if ((player === 'p1' && p2Locked) || (player === 'p2' && p1Locked)) {
                        handleBattleEnd('draw');
                    }
                }
            };

            const handleBattleEnd = (winner) => {
                setRoundWinner(winner);
                const cur = battleQs[battleRound - 1];
                
                if(winner === 'p1') {
                    const pts = (cur.diff * 100) + (timeLeft * 10);
                    setP1Score(prev => prev + pts);
                } else if(winner === 'p2') {
                    const pts = (cur.diff * 100) + (timeLeft * 10);
                    setP2Score(prev => prev + pts);
                }

                setTimeout(() => {
                    if(battleRound < 3) {
                        setBattleRound(prev => prev + 1);
                        setTimeLeft(180); 
                        setP1In('');
                        setP2In('');
                        setP1Locked(false);
                        setP2Locked(false);
                        setRoundWinner(null);
                    } else {
                        setScene('result_battle');
                    }
                }, 3000);
            };

            // ------------------------------------------------------------------------
            // RENDERERS
            // ------------------------------------------------------------------------

            const renderMenu = () => (
                <div className="min-h-screen flex flex-col items-center justify-center p-4 relative overflow-hidden pb-10">
                    <div className="absolute top-[-20%] right-[-10%] w-[600px] h-[600px] bg-blue-600/20 rounded-full blur-[100px] animate-float"></div>
                    <div className="absolute bottom-[-20%] left-[-10%] w-[500px] h-[500px] bg-purple-600/20 rounded-full blur-[100px] animate-float" style={{animationDelay: '1.5s'}}></div>

                    <div className="z-10 text-center animate-slide-up w-full max-w-5xl">
                        <div className="mb-8">
                            <div className="text-gray-400 font-bold tracking-[0.5em] text-sm uppercase mb-2">Produced by OneSeokT</div>
                            <h1 className="text-5xl md:text-9xl font-logo text-white mb-2 leading-none neon-blue">MATH VIBE</h1>
                            <div className="flex flex-col md:flex-row items-center justify-center gap-4 mt-4 transform -rotate-2">
                                <span className="text-3xl md:text-5xl font-game text-white">ÏàòÌïôÏùÄ Î≠êÎã§?</span>
                                <span className="text-5xl md:text-7xl font-marker intro-text-easy neon-purple">EASY</span>
                            </div>
                        </div>

                        <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mt-16 px-4">
                            <button onClick={() => startSolo('challenge', null, 'ALL')} className="glass p-8 rounded-3xl text-left hover:bg-blue-600/20 transition-all group border-t-4 border-blue-500 hover:-translate-y-2">
                                <div className="text-5xl mb-4 group-hover:scale-110 transition-transform">üèÜ</div>
                                <h3 className="text-2xl font-bold text-white mb-2">Ï±åÎ¶∞ÏßÄ Î™®Îìú</h3>
                                <p className="text-gray-400 text-sm">20Îã®Í≥Ñ Î†àÎ≤®ÏóÖ<br/>Î∏åÎ°†Ï¶àÎ∂ÄÌÑ∞ Ï±åÎ¶∞Ï†ÄÍπåÏßÄ</p>
                            </button>
                            <button onClick={() => setScene('setup_practice')} className="glass p-8 rounded-3xl text-left hover:bg-purple-600/20 transition-all group border-t-4 border-purple-500 hover:-translate-y-2">
                                <div className="text-5xl mb-4 group-hover:scale-110 transition-transform">üìö</div>
                                <h3 className="text-2xl font-bold text-white mb-2">Ïú†Ìòï Ïó∞Ïäµ</h3>
                                <p className="text-gray-400 text-sm">ÏïΩÏ†ê ÏßëÏ§ë Í≥µÎûµ<br/>Ïú†Ìòï/ÎÇúÏù¥ÎèÑ/ÎûúÎç§ ÏÑ§Ï†ï</p>
                            </button>
                            <button onClick={startBattle} className="glass-red p-8 rounded-3xl text-left hover:bg-red-600/20 transition-all group border-t-4 border-red-500 hover:-translate-y-2">
                                <div className="text-5xl mb-4 group-hover:scale-110 transition-transform">‚öîÔ∏è</div>
                                <h3 className="text-2xl font-bold text-red-400 mb-2">Í∏∏Í±∞Î¶¨ ÏàòÌïô Î∞∞ÌãÄ</h3>
                                <p className="text-gray-400 text-sm">1 vs 1 ÏßÑÍ≤ÄÏäπÎ∂Ä<br/>3Î∂Ñ ÌÉÄÏûÑÏñ¥ÌÉù & ÌéòÎÑêÌã∞</p>
                            </button>
                        </div>
                    </div>
                </div>
            );

            const renderPracticeSetup = () => (
                <div className="min-h-screen flex flex-col items-center justify-center p-4 pb-10">
                    <h2 className="text-3xl md:text-4xl font-game text-purple-400 mb-10 neon-purple">Ïú†Ìòï Ïó∞Ïäµ ÏÑ§Ï†ï</h2>
                    <div className="glass p-6 md:p-10 rounded-3xl w-full max-w-3xl space-y-8 animate-slide-up">
                        <div>
                            <label className="block text-gray-400 mb-3 font-bold">Í≥ºÎ™© ÏÑ†ÌÉù</label>
                            <div className="grid grid-cols-2 md:grid-cols-5 gap-3">
                                {Object.keys(SUBJ_MAP).map(k => (
                                    <button key={k} onClick={() => setPSubj(k)} className={`py-4 rounded-xl font-bold transition-all ${pSubj===k ? 'bg-purple-600 text-white shadow-lg' : 'bg-slate-800 text-gray-500'}`}>
                                        {SUBJ_MAP[k]}
                                    </button>
                                ))}
                                <button onClick={() => setPSubj('RANDOM')} className={`py-4 rounded-xl font-bold transition-all ${pSubj==='RANDOM' ? 'bg-gradient-to-r from-pink-500 to-yellow-500 text-white shadow-lg' : 'bg-slate-800 text-gray-500'}`}>
                                    ÎûúÎç§ üé≤
                                </button>
                            </div>
                        </div>
                        <div>
                            <label className="block text-gray-400 mb-3 font-bold">ÎÇúÏù¥ÎèÑ</label>
                            <div className="flex flex-wrap gap-3">
                                {[1,2,3,4,5,6].map(d => (
                                    <button key={d} onClick={() => setPDiff(d)} className={`px-4 py-2 rounded-lg font-bold border transition-all ${pDiff===d ? 'bg-white text-black' : 'border-slate-600 text-gray-500'}`}>
                                        {TIERS[d-1].name}
                                    </button>
                                ))}
                                <button onClick={() => setPDiff('ALL')} className={`px-6 py-2 rounded-lg font-bold border transition-all ${pDiff==='ALL' ? 'bg-gradient-to-r from-green-400 to-blue-500 text-white border-transparent' : 'border-slate-600 text-gray-500'}`}>
                                    RANDOM
                                </button>
                            </div>
                        </div>
                        <div className="flex gap-4 pt-4">
                            <button onClick={() => setScene('menu')} className="flex-1 py-4 bg-gray-800 rounded-xl font-bold text-gray-400">Îí§Î°ú</button>
                            <button onClick={() => startSolo('practice', pSubj, pDiff)} disabled={!pSubj || !pDiff} className={`flex-1 py-4 rounded-xl font-bold text-xl ${pSubj && pDiff ? 'bg-purple-600 text-white' : 'bg-gray-700 text-gray-600'}`}>
                                START
                            </button>
                        </div>
                    </div>
                </div>
            );

            const renderSoloGame = () => {
                const q = soloQs[qIndex];
                const tier = TIERS[q.diff-1];
                const progress = (qIndex / soloQs.length) * 100;
                const timeMax = q.time;
                const timePercent = (timeLeft / timeMax) * 100;

                return (
                    <div className="min-h-screen flex flex-col items-center justify-center p-4 relative pb-10">
                        <div className="absolute top-0 left-0 h-1.5 w-full bg-slate-800">
                             <div className="h-full bg-gradient-to-r from-indigo-500 to-purple-500 transition-all duration-300" style={{width: `${progress}%`}}></div>
                        </div>
                        
                        <div className="w-full max-w-4xl mb-6 flex justify-between items-end mt-8">
                            <div>
                                <span className={`px-3 py-1 rounded text-xs font-black ${tier.bg} text-white mb-2 inline-block`}>{tier.name}</span>
                                <div className="text-gray-400 text-sm font-bold">{SUBJ_MAP[q.subject]}</div>
                            </div>
                            <div className="text-right">
                                <div className="text-3xl md:text-4xl font-mono font-bold text-yellow-400 neon-blue">{score.toLocaleString()}</div>
                                <div className="text-xs text-gray-500">SCORE</div>
                            </div>
                        </div>

                        <div className={`glass w-full max-w-4xl p-6 md:p-16 rounded-[2rem] md:rounded-[2.5rem] relative overflow-hidden transition-all duration-200 ${feedback==='wrong' ? 'border-red-500 shake' : feedback==='correct' ? 'border-green-500' : ''}`}>
                            <div className="absolute top-0 left-0 w-full h-1 bg-gray-700">
                                <div className={`h-full transition-all duration-1000 linear ${timeLeft <= 5 ? 'bg-red-500' : 'bg-blue-400'}`} style={{width: `${timePercent}%`}}></div>
                            </div>
                            <div className="absolute top-6 right-8 font-mono text-2xl md:text-3xl font-bold text-gray-500">{timeLeft}s</div>
                            
                            <div className="min-h-[150px] md:min-h-[200px] flex items-center justify-center text-center my-4">
                                <div className="text-2xl md:text-5xl font-medium leading-relaxed" dangerouslySetInnerHTML={{__html: q.q}}></div>
                            </div>

                            <div className="w-full max-w-xl mx-auto relative mt-4">
                                <input type="text" value={input} onChange={e => setInput(e.target.value)} onKeyDown={e => e.key === 'Enter' && !feedback && handleSoloSubmit(null)}
                                    className="w-full bg-slate-900/80 border border-slate-600 rounded-2xl py-4 md:py-6 px-8 text-center text-2xl md:text-3xl outline-none focus:border-blue-500 transition-all placeholder-gray-700"
                                    placeholder="Ï†ïÎãµ ÏûÖÎ†•" autoFocus
                                />
                                <button onClick={() => !feedback && handleSoloSubmit(null)} className="absolute right-2 top-2 bottom-2 aspect-square bg-blue-600 rounded-xl flex items-center justify-center hover:bg-blue-500">‚èé</button>
                            </div>

                            {feedback && (
                                <div className="absolute inset-0 bg-black/80 backdrop-blur-sm flex flex-col items-center justify-center z-20 animate-slide-up">
                                    <div className={`text-5xl md:text-7xl font-black transform -rotate-6 mb-4 ${feedback==='correct' ? 'text-green-400' : 'text-red-500'}`}>
                                        {feedback==='correct' ? 'NICE!' : feedback==='timeout' ? 'TIME OUT' : 'WRONG'}
                                    </div>
                                    <div className="text-xl md:text-2xl font-bold">Ï†ïÎãµ: <span className="text-yellow-400">{q.a}</span></div>
                                    {feedback==='correct' && combo>1 && <div className="mt-4 text-cyan-400 font-mono font-bold animate-float">{combo} COMBO!</div>}
                                </div>
                            )}
                        </div>
                    </div>
                );
            };

            const renderBattleGame = () => {
                const q = battleQs[battleRound-1];
                const tier = TIERS[q.diff-1];

                return (
                    <div className="min-h-screen flex flex-col bg-slate-900 pb-10">
                        <div className="flex justify-between items-center p-4 md:p-6 bg-slate-800/80 backdrop-blur border-b border-slate-700 sticky top-0 z-30">
                            <div className="flex items-center gap-2 md:gap-4">
                                <span className="bg-red-600 text-white font-black px-3 py-1 md:px-4 md:py-2 rounded text-sm md:text-xl italic">ROUND {battleRound}/3</span>
                                <span className={`font-bold px-2 py-1 rounded border ${tier.color} border-current text-xs md:text-sm`}>{tier.name}</span>
                            </div>
                            <div className="text-4xl md:text-6xl font-mono font-bold text-white tracking-widest neon-red">{timeLeft}</div>
                        </div>

                        <div className="flex-1 flex items-center justify-center p-4 relative">
                            <div className="w-full max-w-6xl glass p-6 md:p-12 rounded-[2rem] md:rounded-[3rem] text-center relative">
                                <div className="text-gray-400 font-bold mb-4 uppercase tracking-widest">{SUBJ_MAP[q.subject]}</div>
                                <div className="text-2xl md:text-5xl font-medium leading-relaxed" dangerouslySetInnerHTML={{__html: q.q}}></div>
                                
                                {roundWinner && (
                                    <div className="absolute inset-0 z-20 flex flex-col items-center justify-center bg-black/90 backdrop-blur-md rounded-[2rem] md:rounded-[3rem] animate-slide-up">
                                        <div className="text-2xl md:text-3xl text-gray-400 font-bold mb-2">WINNER</div>
                                        {roundWinner === 'timeout' || roundWinner === 'draw' ? (
                                            <div className="text-5xl md:text-7xl font-black text-gray-500">{roundWinner === 'draw' ? 'DRAW' : 'TIME OUT'}</div>
                                        ) : (
                                            <div className={`text-6xl md:text-9xl font-black italic ${roundWinner==='p1' ? 'text-blue-500' : 'text-red-500'}`}>
                                                {roundWinner === 'p1' ? 'PLAYER 1' : 'PLAYER 2'}
                                            </div>
                                        )}
                                        {roundWinner !== 'timeout' && roundWinner !== 'draw' && <div className="mt-4 text-xl md:text-2xl text-yellow-400 font-bold">+{q.diff*100 + timeLeft*10} PTS</div>}
                                    </div>
                                )}
                            </div>
                        </div>

                        <div className="grid grid-cols-2 border-t border-slate-700 min-h-[300px]">
                            <div className={`relative flex flex-col items-center justify-center border-r border-slate-700 transition-colors p-2 ${roundWinner==='p1' ? 'bg-blue-900/40' : 'bg-slate-900'} ${p1Locked ? 'locked-overlay' : ''}`}>
                                <div className="absolute top-2 left-2 font-black text-blue-500 text-xl md:text-3xl">PLAYER 1</div>
                                <div className="absolute top-2 right-2 font-mono text-white text-xl md:text-3xl font-bold">{p1Score}</div>
                                
                                {!p1Locked ? (
                                    <div className="w-full max-w-md bg-slate-800/50 p-4 rounded-2xl border border-slate-600 mt-8">
                                        <label className="block text-gray-400 text-xs md:text-sm font-bold mb-2">ÎãµÏïà (Í∏∞Ìöå 1Î≤à)</label>
                                        <input type="text" value={p1In} onChange={e => setP1In(e.target.value)} onKeyDown={e => e.key==='Enter' && !roundWinner && checkBattle('p1', p1In)} disabled={!!roundWinner} placeholder="ÏûÖÎ†•"
                                            className="w-full bg-transparent border-b-2 border-blue-500 text-center text-3xl md:text-4xl text-white focus:outline-none pb-2 mb-4 placeholder-gray-600 font-mono" autoComplete="off" />
                                        <button onClick={() => !roundWinner && checkBattle('p1', p1In)} className="w-full py-3 bg-blue-600 text-white font-black text-lg rounded-xl shadow-lg hover:bg-blue-500 transition-all active:scale-95">
                                            Ï†úÏ∂ú
                                        </button>
                                    </div>
                                ) : (
                                    <div className="text-2xl md:text-4xl font-black text-red-500 border-4 border-red-500 p-2 md:p-4 rounded-xl transform -rotate-12 opacity-80">LOCKED</div>
                                )}
                            </div>
                            <div className={`relative flex flex-col items-center justify-center transition-colors p-2 ${roundWinner==='p2' ? 'bg-red-900/40' : 'bg-slate-900'} ${p2Locked ? 'locked-overlay' : ''}`}>
                                <div className="absolute top-2 right-2 font-black text-red-500 text-xl md:text-3xl">PLAYER 2</div>
                                <div className="absolute top-2 left-2 font-mono text-white text-xl md:text-3xl font-bold">{p2Score}</div>
                                
                                {!p2Locked ? (
                                    <div className="w-full max-w-md bg-slate-800/50 p-4 rounded-2xl border border-slate-600 mt-8">
                                        <label className="block text-gray-400 text-xs md:text-sm font-bold mb-2">ÎãµÏïà (Í∏∞Ìöå 1Î≤à)</label>
                                        <input type="text" value={p2In} onChange={e => setP2In(e.target.value)} onKeyDown={e => e.key==='Enter' && !roundWinner && checkBattle('p2', p2In)} disabled={!!roundWinner} placeholder="ÏûÖÎ†•"
                                            className="w-full bg-transparent border-b-2 border-red-500 text-center text-3xl md:text-4xl text-white focus:outline-none pb-2 mb-4 placeholder-gray-600 font-mono" autoComplete="off" />
                                        <button onClick={() => !roundWinner && checkBattle('p2', p2In)} className="w-full py-3 bg-red-600 text-white font-black text-lg rounded-xl shadow-lg hover:bg-red-500 transition-all active:scale-95">
                                            Ï†úÏ∂ú
                                        </button>
                                    </div>
                                ) : (
                                    <div className="text-2xl md:text-4xl font-black text-red-500 border-4 border-red-500 p-2 md:p-4 rounded-xl transform rotate-12 opacity-80">LOCKED</div>
                                )}
                            </div>
                        </div>
                    </div>
                );
            };

            const renderSoloResult = () => (
                <div className="min-h-screen flex flex-col items-center justify-center p-4 pb-10">
                    <h2 className="text-4xl md:text-6xl font-game text-white mb-4 neon-blue">GAME OVER</h2>
                    <div className="glass p-8 md:p-12 rounded-[2rem] text-center w-full max-w-lg mb-8 border-t-4 border-blue-500">
                        <div className="text-sm font-bold text-blue-400 tracking-widest mb-2">FINAL SCORE</div>
                        <div className="text-6xl md:text-8xl font-mono font-bold text-yellow-400 mb-8">{score.toLocaleString()}</div>
                        <div className="grid grid-cols-2 gap-4 bg-slate-800/50 p-6 rounded-2xl">
                            <div><div className="text-xs text-gray-500 mb-1">CORRECT</div><div className="text-xl md:text-2xl font-bold">{history.filter(h=>h.isCorrect).length} / {soloQs.length}</div></div>
                            <div><div className="text-xs text-gray-500 mb-1">MODE</div><div className="text-xl md:text-2xl font-bold capitalize">{soloMode}</div></div>
                        </div>
                    </div>
                    <div className="flex gap-4 w-full max-w-md">
                        <button onClick={() => setScene('note')} className="flex-1 py-4 bg-red-600 rounded-xl font-bold hover:bg-red-500 transition-all text-sm md:text-base">Ïò§Îãµ ÎÖ∏Ìä∏</button>
                        <button onClick={() => setScene('menu')} className="flex-1 py-4 bg-gray-700 rounded-xl font-bold hover:bg-gray-600 transition-all text-sm md:text-base">Î©îÏù∏ Î©îÎâ¥</button>
                    </div>
                </div>
            );

            const renderBattleResult = () => {
                const winner = p1Score > p2Score ? 'PLAYER 1' : p1Score < p2Score ? 'PLAYER 2' : 'DRAW';
                const winColor = p1Score > p2Score ? 'text-blue-500' : p1Score < p2Score ? 'text-red-500' : 'text-white';
                return (
                    <div className="min-h-screen flex flex-col items-center justify-center p-4 pb-10">
                        <h2 className="text-4xl md:text-5xl font-game text-white mb-10">BATTLE RESULT</h2>
                        <div className="glass p-8 md:p-12 rounded-[2rem] w-full max-w-4xl flex flex-col items-center">
                            <div className="text-center mb-12">
                                <div className="text-xl text-gray-500 font-bold tracking-widest mb-2">CHAMPION</div>
                                <div className={`text-6xl md:text-9xl font-black italic ${winColor} neon-blue`}>{winner}</div>
                            </div>
                            <div className="w-full grid grid-cols-2 gap-4 md:gap-8 mb-12">
                                <div className={`p-4 md:p-8 rounded-3xl bg-slate-800 ${p1Score>p2Score ? 'border-4 border-blue-500' : 'opacity-50'}`}>
                                    <div className="text-blue-400 font-bold mb-2 text-sm md:text-base">PLAYER 1</div>
                                    <div className="text-3xl md:text-6xl font-mono font-bold">{p1Score}</div>
                                </div>
                                <div className={`p-4 md:p-8 rounded-3xl bg-slate-800 ${p2Score>p1Score ? 'border-4 border-red-500' : 'opacity-50'}`}>
                                    <div className="text-red-400 font-bold mb-2 text-sm md:text-base">PLAYER 2</div>
                                    <div className="text-3xl md:text-6xl font-mono font-bold">{p2Score}</div>
                                </div>
                            </div>
                            <button onClick={() => setScene('menu')} className="px-8 md:px-12 py-4 bg-white text-black font-black text-lg md:text-xl rounded-full hover:scale-105 transition-transform">MAIN MENU</button>
                        </div>
                    </div>
                );
            };

            const renderNote = () => (
                <div className="min-h-screen flex flex-col items-center p-4 pt-10 md:pt-20 pb-20">
                    <h2 className="text-3xl md:text-4xl font-game text-red-400 mb-8 neon-red">Ïò§Îãµ ÎÖ∏Ìä∏</h2>
                    <div className="w-full max-w-3xl space-y-6">
                        {history.filter(h=>!h.isCorrect).length === 0 ? (
                            <div className="text-center text-gray-500 mt-20 text-xl">ÌãÄÎ¶∞ Î¨∏Ï†úÍ∞Ä ÏóÜÏäµÎãàÎã§. ÏôÑÎ≤ΩÌï¥Ïöî! üëç</div>
                        ) : (
                            history.filter(h=>!h.isCorrect).map((h, i) => (
                                <div key={i} className="glass p-6 md:p-8 rounded-2xl border-l-4 border-red-500">
                                    <div className="flex justify-between mb-4 text-xs md:text-sm text-gray-400">
                                        <span className="font-bold uppercase">{SUBJ_MAP[h.subject]}</span>
                                        <span>TIER {h.diff}</span>
                                    </div>
                                    <div className="text-lg md:text-xl font-medium mb-6" dangerouslySetInnerHTML={{__html: h.q}}></div>
                                    <div className="flex justify-between items-center bg-slate-900/50 p-4 rounded-xl">
                                        <div className="text-red-400 line-through decoration-2 text-sm md:text-base">{h.userAns}</div>
                                        <div className="text-green-400 font-bold text-lg md:text-xl">{h.a}</div>
                                    </div>
                                </div>
                            ))
                        )}
                    </div>
                    <div className="fixed bottom-6 z-50">
                        <button onClick={() => setScene('result_solo')} className="px-8 md:px-10 py-3 bg-gray-800 hover:bg-gray-700 rounded-full font-bold shadow-xl border border-gray-600">Îã´Í∏∞</button>
                    </div>
                </div>
            );

            return (
                <div className="bg-[#0f172a] text-white min-h-screen">
                    {scene === 'menu' && renderMenu()}
                    {scene === 'setup_practice' && renderPracticeSetup()}
                    {scene === 'game_solo' && renderSoloGame()}
                    {scene === 'result_solo' && renderSoloResult()}
                    {scene === 'note' && renderNote()}
                    {scene === 'game_battle' && renderBattleGame()}
                    {scene === 'result_battle' && renderBattleResult()}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
